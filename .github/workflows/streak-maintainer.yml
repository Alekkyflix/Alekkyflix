name: Streak Maintainer
on:
  schedule:
    - cron: '0 12 * * *'  # Runs daily at 12:00 UTC
  workflow_dispatch:       # Allows manual triggering

jobs:
  streak:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  # Required for push access
          fetch-depth: 0  # Ensures full commit history

      - name: Configure Git
        run: |
          git config --global user.name "Alekkyflix Bot"
          git config --global user.email "120592887+Alekkyflix@users.noreply.github.com"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/Alekkyflix/Alekkyflix.git

      - name: Human-like commits
        run: |
          # Skip 10% of days randomly
          if (( $RANDOM % 10 == 0 )); then
            echo "🔄 Skipping today for realism $(date +%Y-%m-%d)" >> skip_days.log
            git add skip_days.log
            git commit -m "⏭️ Skip day for natural pattern" --allow-empty
            exit 0
          fi

          # Weekend logic (Sat/Sun)
          if [ $(date +%u) -gt 5 ]; then
            echo "# Light weekend update $(date)" >> weekend_updates.md
            git add weekend_updates.md
            git commit -m "🌴 Weekend touch-up [skip ci]" --allow-empty
          else
            # Weekday logic (Mon-Fri)
            COMMITS=$(( RANDOM % 3 + 1 ))  # 1-3 commits/day
            for ((i=1; i<=COMMITS; i++)); do
              echo "📌 Update $i/3 - $(date)" >> daily_logs/$(date +%Y-%m-%d).md
              git add .
              git commit -m "💼 Day $(date +%A) update $i/$COMMITS" --allow-empty
              sleep $(( RANDOM % 10 ))  # Random delay between commits
            done
          fi

          # Push all changes
          git push origin main
